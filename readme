# 本番環境（MariaDB）で事前に実行しておくべきSQL
# (SQL that should be executed in advance in the production environment (MariaDB))
DROP TABLE IF EXISTS t_task_question;
DROP TABLE IF EXISTS t_task_course;
DROP TABLE IF EXISTS t_user_task_code;
DROP TABLE IF EXISTS t_message;
DROP TABLE IF EXISTS t_class_course;
DROP TABLE IF EXISTS t_user_course;
DROP TABLE IF EXISTS t_course;
DROP TABLE IF EXISTS t_user_class;
DROP TABLE IF EXISTS t_task_output;
DROP TABLE IF EXISTS t_task_input;
DROP TABLE IF EXISTS t_class;
DROP TABLE IF EXISTS t_task;
DROP TABLE IF EXISTS t_language;
DROP TABLE IF EXISTS t_user;
DROP TABLE IF EXISTS t_question;
DROP TABLE IF EXISTS m_role;


CREATE TABLE m_role(id CHAR(3), name VARCHAR(40), PRIMARY KEY(id)) CHARACTER SET 'utf8';
CREATE TABLE t_question(id INT AUTO_INCREMENT, title VARCHAR(100), description VARCHAR(1000), input_num TINYINT DEFAULT 0 NOT NULL, public_flg TINYINT(1) NOT NULL, PRIMARY KEY(id)) CHARACTER SET 'utf8';
CREATE TABLE t_user(id VARCHAR(20), password VARCHAR(10), name VARCHAR(100), role_id CHAR(3), PRIMARY KEY(id)) CHARACTER SET 'utf8';
CREATE TABLE t_language(id CHAR(3), name VARCHAR(60), PRIMARY KEY(id));
CREATE TABLE t_task(id INT AUTO_INCREMENT, language_id CHAR(3), title VARCHAR(100), description VARCHAR(1000), question_id INT NOT NULL, self_made_check_code TEXT, PRIMARY KEY(id)) CHARACTER SET 'utf8';
CREATE TABLE t_class(id INT AUTO_INCREMENT, name VARCHAR(200), PRIMARY KEY(id)) CHARACTER SET 'utf8';
CREATE TABLE t_task_input(id INT AUTO_INCREMENT, task_id INT NOT NULL, val_number TINYINT NOT NULL, data_type VARCHAR(100), PRIMARY KEY(id)) CHARACTER SET 'utf8';
CREATE TABLE t_task_output(id INT AUTO_INCREMENT, task_id INT NOT NULL, val_number TINYINT NOT NULL, parametor VARCHAR(200), public_flg TINYINT(1), PRIMARY KEY(id)) CHARACTER SET 'utf8';
CREATE TABLE t_user_class(id INT AUTO_INCREMENT, user_id VARCHAR(20), class_id INT, PRIMARY KEY(id)) CHARACTER SET 'utf8';
CREATE TABLE t_course(id INT AUTO_INCREMENT, name VARCHAR(200), PRIMARY KEY(id)) CHARACTER SET 'utf8';
CREATE TABLE t_user_course(id INT AUTO_INCREMENT, user_id VARCHAR(20), course_id INT, PRIMARY KEY(id)) CHARACTER SET 'utf8';
CREATE TABLE t_class_course(id INT AUTO_INCREMENT, class_id INT, course_id INT, PRIMARY KEY(id)) CHARACTER SET 'utf8';
CREATE TABLE t_message(id INT AUTO_INCREMENT, message VARCHAR(1000), student_id VARCHAR(20), course_id INT, task_id INT, read_flg TINYINT(1), PRIMARY KEY(id)) CHARACTER SET 'utf8';
CREATE TABLE t_user_task_code(id INT AUTO_INCREMENT, user_id VARCHAR(20), course_id INT, task_id INT, status TINYINT, code LONGTEXT, check_code LONGTEXT, additional_code LONGTEXT, PRIMARY KEY(id)) CHARACTER SET 'utf8';
CREATE TABLE t_task_question(id INT AUTO_INCREMENT, task_id INT, question_id INT, PRIMARY KEY(id)) CHARACTER SET 'utf8';
CREATE TABLE t_task_course(id INT AUTO_INCREMENT, task_id INT, course_id INT, number INT, PRIMARY KEY(id)) CHARACTER SET 'utf8';

INSERT INTO m_role(id, name) VALUES('001', '管理者');
INSERT INTO m_role(id, name) VALUES('002', '先生');
INSERT INTO m_role(id, name) VALUES('003', '学生');
INSERT INTO t_language(id, name) VALUES('001', 'Ｃ／Ｃ＋＋');
INSERT INTO t_language(id, name) VALUES('002', 'Ｊａｖａ');
INSERT INTO t_language(id, name) VALUES('003', 'Ｐｙｔｈｏｎ');
INSERT INTO t_question(id, title, description, input_num, public_flg) VALUES(1, '足し算問題', '与えられた２つの数値を足し合わせた結果を返す', 2, TRUE);
INSERT INTO t_question(id, title, description, input_num, public_flg) VALUES(2, '引き算算問題', '与えられた２つの数値を引いた結果を返す', 2, TRUE);
INSERT INTO t_question(id, title, description, input_num, public_flg) VALUES(3, '掛け算問題', '与えられた２つの数値を掛け合わせた結果を返す', 2, FALSE);
INSERT INTO t_question(id, title, description, input_num, public_flg) VALUES(4, '割り算問題', '与えられた２つの数値を割った結果を返す', 2, FALSE);
# t_task_outputを問題ごと3つ（公開用１つ、秘匿用２つ）
# t_task_inputを問題ごと2つ（入力用引数２つ）
# t_taskを３つ（足し算から２つ（Java、C）、引き算から１つ（Python））
#INSERT INTO t_task() VALUES();
#INSERT INTO t_task_input() VALUES();
#INSERT INTO t_task_output() VALUES();
INSERT INTO t_user(id, password, name, role_id) VALUES('testadmin1', 'password', 'テスト用管理者１', '001');
INSERT INTO t_user(id, password, name, role_id) VALUES('testteacher1', 'password', 'テスト用先生１', '002');
INSERT INTO t_user(id, password, name, role_id) VALUES('teststudent1', 'password', 'テスト用学生１', '003');
INSERT INTO t_user(id, password, name, role_id) VALUES('teststudent2', 'password', 'テスト用学生２', '003');
INSERT INTO t_class(id, name) VALUES(1, 'クラスＡ');
INSERT INTO t_class(id, name) VALUES(2, 'クラスＢ');
INSERT INTO t_user_class(user_id, class_id) VALUES('teststudent1', 1);
INSERT INTO t_user_class(user_id, class_id) VALUES('teststudent1', 2);
INSERT INTO t_course(id, name) VALUES(1, 'テストコース');
INSERT INTO t_user_course(user_id, course_id) VALUES('teststudent1', 1);
INSERT INTO t_class_course(class_id, course_id) VALUES(2, 1);

# 一旦退避、テスト用
DROP TABLE IF EXISTS t_question;
CREATE TABLE t_question(id INT AUTO_INCREMENT, title VARCHAR(100), description VARCHAR(1000), input_num TINYINT DEFAULT 0, public_flg TINYINT(1) NOT NULL, primary key(id)) character set 'utf8';

